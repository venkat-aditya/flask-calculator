parameters:
  solutionPath:
jobs:
- job: ContinousIntegrationForPython
  displayName: CI for Python
  steps:
    - checkout: self
      displayName: Checkout repository

    - task: UsePythonVersion@0
      inputs:
        versionSpec: '3.10'
      displayName: 'Use Python $(python.version)'

    - script: |
        python3 -m venv env
        source env/bin/activate
        pip install -r requirements.txt
      displayName: 'Set Up Development Environment'
      workingDirectory: $(Build.SourcesDirectory)

    - task: ArchiveFiles@2
      displayName: 'Archive files'
      inputs:
        rootFolderOrFile: '$(Build.SourcesDirectory)'
        includeRootFolder: false
        archiveType: zip
        archiveFile: $(Build.ArtifactStagingDirectory)/pythonApp.zip
        replaceExistingArchive: true

    - publish: $(Build.ArtifactStagingDirectory)/pythonApp.zip
      artifact: publishFiles

    - task: AzureRmWebAppDeployment@4
      displayName: 'Deploy to Azure App Service'
      inputs:
        ConnectionType: 'AzureRM'
        azureSubscription: 'ca7e002b-ac4b-46af-8581-9f1885aebcbe'
        appType: 'webAppLinux'  # Use 'webApp' for Windows
        WebAppName: 'pythonflaskapp98'
        package: '$(Build.ArtifactStagingDirectory)/pythonApp.zip'
        StartupCommand: 'python app.py'
